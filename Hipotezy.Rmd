---
title: "Badanie statystyczne wpływu różnych czynników na poziom samopoczucia"
output:
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE, results='asis'}
knitr::opts_chunk$set(echo = F,
                      message = F,
                      warning = F)
```

```{r}
library(alr3)
library(kableExtra)
library(magrittr)
library(plyr)
library(tidyverse)
library(lmtest)
library(ggplot2)
library(ggcorrplot)
library(stargazer)
library(tables)
library(Hmisc)

colf <- colorRampPalette(c("white","royalblue"))
```

# Wstęp

Celem naszego projektu jest analiza statystyczna wpływu różnych czynników na poziom samopoczucia.

# Opis danych

(Import, obróbka, wstępna analiza, testy na normalność)

```{r}
load("dane.RData")
```

# Hipotezy badawcze oraz ich weryfikacja


$H_0:$ nie istnieje zależność pomiędzy zmiennymi.

$H_1:$ istnieje zależność pomiędzy zmiennymi.

Hipotezy badane są na poziomie istotności $\alpha = 0.05$.

## Hipoteza I

Badanie, czy istnieje zależność pomiędzy poczuciem upokorzenia a jakością snu.

```{r}
r1 <- cor.test(x = as.numeric(dane$jakosc_snu), y = as.numeric(dane$upokorzenie),
         method = "spearman")$p.value
wsp_kor1 <- cor.test(x = as.numeric(dane$jakosc_snu), y = as.numeric(dane$upokorzenie),
         method = "spearman")$estimate
r2 <- cor.test(x = as.numeric(dane$jakosc_snu), y = as.numeric(dane$upokorzenie),
         method = "kendall")$p.value
wsp_kor2 <- cor.test(x = as.numeric(dane$jakosc_snu), y = as.numeric(dane$upokorzenie),
         method = "kendall")$estimate
```

P-value dla testu `rho-Spearmana` wynosi `r sprintf("%.10f", r1)`, natomiast dla testu `tau-Kendalla` wynosi `r sprintf("%.10f", r2)`. Nie ma podstaw do odrzucenia hipotezy $H_0$, a więc nie istnieje istotna zależność pomiędzy poczuciem upokorzenia a jakością snu. Współczynniki korelacji dla testów `rho-Spearmana` oraz `tau-Kendalla` wynoszą odpowiednio `r sprintf("%.5f", wsp_kor1)` oraz `r sprintf("%.5f", wsp_kor2)`, ale na poziomie istotności $\alpha = 0.05$ nie są istotne statystycznie.

### Wykresy boxplot
```{r}
par(mfrow=c(1,2))
boxplot(as.numeric(dane$upokorzenie), main = "Poczucie upokorzenia",ylab = "poziomy")
boxplot(as.numeric(dane$jakosc_snu), main = "Jakość snu", ylab = "poziomy")
par(mfrow=c(1,1))
```


### Tabela kontygencji


```{r}
ttab <- prop.table(table(dane$upokorzenie, dane$jakosc_snu), margin = 2)*100
 tabelka <- tabular((Upokorzenie = dane$upokorzenie)~  Format(digits =2)*(`Jakość snu` = dane$jakosc_snu)*Heading()*Percent("col"))

```




```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = TRUE)

```

### Wykresy słupkowe


```{r}
par(mar=c(5.1, 4.1, 4.1, 5.2), xpd=TRUE)
barplot(ttab,
        main = "Odczuwanie upokorzenia w zależności od jakości snu",
        xlab="Jakość snu",
        ylab="Procentowy rozkład poczucia upokorzenia",
        col=colf(7),
        names.arg = c("bardzo zła", "kiepska", "przeciętna", "dobra", "bardzo dobra"))
legend("topright",
       inset=c(-0.2,0),
       title = "Częstość",
       legend = c("nigdy", "b.rzadko", "rzadko", "czasami", "często", "b.często", "zawsze"),
       fill = colf(7),
       cex=0.9)
```



## Hipoteza II

Badanie, czy istnieje zależność pomiędzy dietą a poczuciem radości.

```{r}
r3 <- cor.test(x = as.numeric(dane$dieta), y = as.numeric(dane$radosc),
         method = "spearman")$p.value
r4 <- cor.test(x = as.numeric(dane$dieta), y = as.numeric(dane$radosc),
         method = "kendall")$p.value
```

P-value dla testu `rho-Spearmana` wynosi `r sprintf("%.10f", r3)`, natomiast dla testu `tau-Kendalla` wynosi `r sprintf("%.10f", r4)`. Nie ma podstaw do odrzucenia $H_0$. Nie istnieje istotna zależność pomiędzy dietą a poczuciem radości.

### Wykresy boxplot
```{r}
par(mfrow=c(1,2))
boxplot(as.numeric(dane$dieta), main = "Dieta",ylab = "poziomy")
boxplot(as.numeric(dane$radosc), main = "Poczucie radości", ylab = "poziomy")
par(mfrow=c(1,1))
```

### Tabela kontygencji

```{r}
tabelka <- tabular((`Poczucie radości` = dane$radosc)~  Format(digits =2)*(`Jakość diety` = dane$dieta)*Heading()*Percent("col"))


```

```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = TRUE)

```

### Wykresy słupkowe

```{r}
par(mar=c(5.1, 4.1, 4.1, 5.2), xpd=TRUE)
ttab <- prop.table(table(dane$radosc, dane$dieta), margin = 2)*100

barplot(ttab,
        main = "Odczuwanie radości, w zależności od rodzaju diety",
        xlab="Rodzaj diety",
        ylab="Procentowy rozkład poczucia radości",
        col=colf(7),
        names.arg = c("fast food", "przetworzona", "mięso","wegetariańska", "zbilans."))
legend("topright",
       inset=c(-0.2,0),
       title = "Częstość",
       legend = c("nigdy", "b.rzadko", "rzadko", "czasami", "często", "b.często", "zawsze"),
       fill = colf(7),
       cex=0.9)
```

## Hipoteza III

Badanie, czy istnieje zależność pomiędzy liczbą bliskich znajomych a odczuwaniem niepokoju.

```{r}
r5 <- cor.test(x = as.numeric(dane$liczba_osob_kontakty),
               y = as.numeric(dane$niepokoj),
               method = "spearman")$p.value
r6 <- cor.test(x = as.numeric(dane$liczba_osob_kontakty),
               y = as.numeric(dane$niepokoj),
               method = "kendall")$p.value
```

P-value dla testu `rho-Spearmana` wynosi `r sprintf("%.10f", r5)`, natomiast dla testu `tau-Kendalla` wynosi `r sprintf("%.10f", r6)`. Należy odrzucić hipotezę $H_0$, na rzecz hipotezy alternatywnej $H_1$. Istnieje zależność pomiędzy liczbą osób, z którymi utrzymuje się regularny kontakt a odczuwaniem niepokoju.

### Tabela kontygencji

```{r}
tabelka <- tabular((`Niepokój` = dane$niepokoj)~  Format(digits =2)*(`Liczba bliskich znajomych` = dane$liczba_osob_kontakty)*Heading()*Percent("col"))


```

```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = TRUE)

```

### Wykresy słupkowe

```{r}
par(mar=c(5.1, 4.1, 4.1, 5.2), xpd=TRUE)
ttab <- prop.table(table(dane$niepokoj, dane$liczba_osob_kontakty), margin = 2)*100

barplot(ttab,
        main = "Odczuwanie niepokoju, w zależności od liczby bliskich znajomych",
        xlab="Liczba osób, z którymi utrzymuje się regularny kontakt",
        ylab="Procentowy rozkład poczucia radości",
        col=colf(7),
        names.arg = c("0", "1", "2-3","4-5", "więcej niż 5"))
legend("topright",
       inset=c(-0.2,0),
       title = "Częstość",
       legend = c("nigdy", "b.rzadko", "rzadko", "czasami", "często", "b.często", "zawsze"),
       fill = colf(7),
       cex=0.9)
```

```{r}
wsp_kor5 <- cor.test(x = as.numeric(dane$liczba_osob_kontakty),
               y = as.numeric(dane$niepokoj),
               method = "spearman")$estimate
wsp_kor6 <- cor.test(x = as.numeric(dane$liczba_osob_kontakty),
               y = as.numeric(dane$niepokoj),
               method = "kendall")$estimate
```

Współczynniki korelacji dla testów `rho-Spearmana` i `tau-Kendalla` wynoszą odpowiednio `r wsp_kor5` oraz `r wsp_kor6`. Interpretując te współczynniki oraz dane z wykresów, można stwierdzić, że wraz ze wzrostem liczby osób, z którymi utrzymuje się regularny kontakt, spada częstość odczuwania niepokoju.

## Hipoteza IV

Badanie, czy istnieje zależność pomiędzy liczbą godzin przeznaczonych na korzystanie z urządzeń elektronicznych a poczuciem uzależnienia od urządzeń.

```{r}
r7 <- cor.test(x = as.numeric(dane$godziny_rozrywki_urzadzenia),
               y = as.numeric(dane$poczucie_uzaleznienia_urzadzenia),
               method = "spearman")$p.value
r8 <- cor.test(x = as.numeric(dane$godziny_rozrywki_urzadzenia),
               y = as.numeric(dane$poczucie_uzaleznienia_urzadzenia),
               method = "kendall")$p.value
```

P-value dla testu `rho-Spearmana` wynosi `r sprintf("%.10f", r7)`, natomiast dla testu `tau-Kendalla` wynosi `r sprintf("%.10f", r8)`. Należy odrzucić hipotezę $H_0$, na rzecz hipotezy alternatywnej $H_1$. Istnieje zależność pomiędzy liczbą godzin spędzonych na używaniu urządzeń elektronicznych a poczuciem uzależnienia od nich.

### Tabela kontygencji

```{r}
tabelka <- tabular((`Poczucie uzależnienia` = dane$poczucie_uzaleznienia_urzadzenia)~  Format(digits =2)*(`Godziny spędzone na używaniu urządzeń elektronicznych` = dane$godziny_rozrywki_urzadzenia)*Heading()*Percent("col"))


```

```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = TRUE)

```

### Wykresy słupkowe

```{r}
par(mar=c(5.1, 4.1, 4.1, 5.2), xpd=TRUE)
ttab <- prop.table(table(dane$poczucie_uzaleznienia_urzadzenia, dane$godziny_rozrywki_urzadzenia), margin = 2)*100

barplot(ttab,
        main = "Wykres zależności",
        xlab="Liczba godzin spędzonych na komputerze w celach rozrywkowych",
        ylab="Procentowy rozkład poczucia uzależnienia od urządzeń",
        col=colf(7),
        names.arg = c("mniej niż 1", "1-2", "2-3","3-4", "więcej niż 4"))
legend("topright",
       inset=c(-0.2,0),
       title = "Poczucie uzależnienia",
       legend = c("nigdy", "b.rzadko", "rzadko", "czasami", "często", "b.często", "zawsze"),
       fill = colf(7),
       cex=0.75)
```

```{r}
wsp_kor7 <- cor.test(x = as.numeric(dane$godziny_rozrywki_urzadzenia),
               y = as.numeric(dane$poczucie_uzaleznienia_urzadzenia),
               method = "spearman")$estimate
wsp_kor8 <- cor.test(x = as.numeric(dane$godziny_rozrywki_urzadzenia),
               y = as.numeric(dane$poczucie_uzaleznienia_urzadzenia),
               method = "kendall")$estimate
```

Współczynniki korelacji dla testów `rho-Spearmana` i `tau-Kendalla` wynoszą odpowiednio `r wsp_kor7` oraz `r wsp_kor8`. Wniosek: wraz ze wzrostem liczby godzin, spędzonych na korzystaniu dla rozrywki z urządzeń elektronicznych, wzrasta znacznie poczucie uzależnienia od tych urządzeń.

## Hipoteza V

Badanie, czy istnieje zależność pomiędzy posiadaniem wyznaczonych pór snu a jego jakością.

```{r}
r9 <- cor.test(x = as.numeric(dane$wyzn_pory_snu),
               y = as.numeric(dane$jakosc_snu),
               method = "spearman")$p.value
r10 <- cor.test(x = as.numeric(dane$wyzn_pory_snu),
               y = as.numeric(dane$jakosc_snu),
               method = "kendall")$p.value
```

P-value dla testu `rho-Spearmana` wynosi `r sprintf("%.10f", r9)`, natomiast dla testu `tau-Kendalla` wynosi `r sprintf("%.10f", r10)`. Należy odrzucić hipotezę $H_0$, na rzecz hipotezy alternatywnej $H_1$. Istnieje zależność pomiędzy posiadaniem wyznaczonych pór snu a jego jakością.

### Tabela kontygencji

```{r}
tabelka <- tabular((`Jakość snu` = dane$jakosc_snu)~  Format(digits =2)*(`Posiadanie wyznaczonych pór snu` = dane$wyzn_pory_snu)*Heading()*Percent("col"))


```

```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = TRUE)

```

### Wykresy słupkowe

```{r}
par(mar=c(5.1, 4.1, 4.1, 5.2), xpd=TRUE)
ttab <- prop.table(table(dane$jakosc_snu, dane$wyzn_pory_snu), margin = 2)*100

barplot(ttab,
        main = "Czy masz wyznaczone pory snu?",
        ylab="Rozkład procentowy jakości snu",
        col = colf(5),
        names.arg = c("nie", "raczej nie", "czasami", "raczej tak", "tak"))
legend("topright",
       inset=c(-0.2,0),
       title = "Jakość snu",
       legend = c("b.zła", "kiepska", "przeciętna", "dobra", "b.dobra"),
       fill = colf(5),
       cex=0.8)
```

```{r}
wsp_kor9 <- cor.test(x = as.numeric(dane$wyzn_pory_snu),
               y = as.numeric(dane$jakosc_snu),
               method = "spearman")$estimate
wsp_kor10 <- cor.test(x = as.numeric(dane$wyzn_pory_snu),
               y = as.numeric(dane$jakosc_snu),
               method = "kendall")$estimate
```

Współczynniki korelacji dla testów `rho-Spearmana` i `tau-Kendalla` są dość duże i wynoszą odpowiednio `r wsp_kor9` oraz `r wsp_kor10`. Im bardziej regularne są pory snu, tym lepsza jest jego jakość.

## Hipoteza VI

Badanie, czy istnieje zależność pomiędzy liczbą godzin przeznaczonych na uprawianie sportu a odczuwaniem załamania.

```{r}
r11 <- cor.test(x = as.numeric(dane$godziny_sportu),
               y = as.numeric(dane$zalamanie),
               method = "spearman")$p.value
r12 <- cor.test(x = as.numeric(dane$godziny_sportu),
               y = as.numeric(dane$zalamanie),
               method = "kendall")$p.value
```

P-value dla testu `rho-Spearmana` wynosi `r sprintf("%.10f", r11)`, natomiast dla testu `tau-Kendalla` wynosi `r sprintf("%.10f", r12)`. Należy odrzucić hipotezę $H_0$, na rzecz hipotezy alternatywnej $H_1$. Istnieje zależność pomiędzy liczbą godzin przeznaczonych na uprawianie sportu a odczuwaniem załamania.

### Tabela kontygencji

```{r}
tabelka <- tabular((`Załamanie` = dane$zalamanie)~  Format(digits =2)*(`Liczba godzin przeznaczonych na sport` = dane$godziny_sportu)*Heading()*Percent("col"))


```

```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = TRUE)

```

### Wykresy słupkowe

```{r}
par(mar=c(5.1, 4.1, 4.1, 5.2), xpd=TRUE)
ttab <- prop.table(table(dane$zalamanie, dane$godziny_sportu), margin = 2)*100

barplot(ttab,
        main = "Wykres zależności",
        xlab="Liczba godzin w tygodniu przeznaczonych na sport",
        ylab="Rozkład procentowy poczucia załamania",
        col = colf(7),
        names.arg = c("0", "mniej niż 1", "1-2,5", "2,5-4", "więcej niż 4"))
legend("topright",
       inset=c(-0.2,0),
       title = "Załamanie",
       legend = c("nigdy", "b.rzadko", "rzadko", "czasami", "często", "b.często", "zawsze"),
       fill = colf(7),
       cex=0.8)
```

```{r}
wsp_kor11 <- cor.test(x = as.numeric(dane$godziny_sportu),
               y = as.numeric(dane$zalamanie),
               method = "spearman")$estimate
wsp_kor12 <- cor.test(x = as.numeric(dane$godziny_sportu),
               y = as.numeric(dane$zalamanie),
               method = "kendall")$estimate
```

Współczynniki korelacji dla testów `rho-Spearmana` i `tau-Kendalla` wynoszą odpowiednio `r wsp_kor11` oraz `r wsp_kor12`. Im więcej godzin poświęca się tygodniowo na sport, tym rzadziej odczuwa się załamanie.

## Hipoteza VII

Badanie, czy istnieje zależność pomiędzy jakością posiłków a dobrym humorem.

```{r}
r13 <- cor.test(x = as.numeric(dane$jakosc_posilkow),
               y = as.numeric(dane$dobry_humor),
               method = "spearman")$p.value
r14 <- cor.test(x = as.numeric(dane$jakosc_posilkow),
               y = as.numeric(dane$dobry_humor),
               method = "kendall")$p.value
```

P-value dla testu `rho-Spearmana` wynosi `r sprintf("%.10f", r13)`, natomiast dla testu `tau-Kendalla` wynosi `r sprintf("%.10f", r14)`. Należy odrzucić hipotezę $H_0$, na rzecz hipotezy alternatywnej $H_1$. Istnieje zależność pomiędzy jakością posiłków a dobrym humorem.

### Tabela kontygencji

```{r}
tabelka <- tabular((`Dobry humor` = dane$dobry_humor)~  Format(digits =2)*(`Jakość posiłków` = dane$jakosc_posilkow)*Heading()*Percent("col"))


```

```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = TRUE)

```

### Wykresy słupkowe

```{r}
par(mar=c(5.1, 4.1, 4.1, 5.2), xpd=TRUE)
ttab <- prop.table(table(dane$dobry_humor, dane$jakosc_posilkow), margin = 2)*100

barplot(ttab,
        main = "Jak dużą uwagę przykładasz do jakości swoich posiłków?",
        ylab="Rozkład procentowy aktualnego humoru",
        col = colf(5),
        names.arg = c("żadną", "małą", "średnią", "dużą", "bardzo dużą"))
legend("topright",
       inset=c(-0.2,0),
       title = "Humor",
       legend = c("zły", "kiepski", "średni", "dobry", "b.dobry"),
       fill = colf(5),
       cex=0.95)
```

```{r}
wsp_kor13 <- cor.test(x = as.numeric(dane$jakosc_posilkow),
               y = as.numeric(dane$dobry_humor),
               method = "spearman")$estimate
wsp_kor14 <- cor.test(x = as.numeric(dane$jakosc_posilkow),
               y = as.numeric(dane$dobry_humor),
               method = "kendall")$estimate
```

Zarówno współczynniki korelacji dla testów `rho-Spearmana` i `tau-Kendalla` wynoszące odpowiednio `r wsp_kor13` oraz `r wsp_kor14`, jak i wykresy słupkowe jasno wskazują na istotną zależność pomiędzy badanymi zmiennymi. Im większe znaczenie ma jakość spożywanych posiłków, tym lepszy humor się odczuwa.

## Hipoteza VIII

Badanie zależności między płcią a ogólną oceną samopoczucia.

### Średnia ocena samopoczucia w grupie kobiet i mężczyzn

```{r}
tabelka <- tabular((`Ogólna ocena samopoczucia` = dane$ocena_samop_ogolna)~  Format(digits =2)*(`Płeć` = dane$plec)*Heading()*mean)


```

```{r results = 'asis'}


 toKable(tabelka) %>%
   kable_styling(full_width = F)

```

### Wykres boxplot

```{r}
boxplot(dane$ocena_samop_ogolna~dane$plec)

```

### Badanie zależności

```{r}
shapiro <- shapiro.test(dane$ocena_samop_ogolna)$p.value

```

P-value z testu Shapio-Wilka dla cechy Ogólna ocena samopoczucia wynosi `r sprintf("%.5f", shapiro)`, zatem ta cecha nie ma rozkładu normalnego.  Stosujemy test Manna - Whitney'a - Wilcoxona.




```{r}
pval <- wilcox.test(ocena_samop_ogolna~plec, data = dane)$p.value
```


P-value z testu Manna - Whitney'a - Wilcoxona wynosi `r sprintf("%.5f", pval)`. Istnieje zależność pomiędzy płcią a ogólną oceną samopoczucia.

```{r}
kobiety <- subset(dane, dane$plec == "kobieta")
mezczyzni <- subset(dane, dane$plec == "mężczyzna")
```

### Badanie równości średnich

```{r}
pval <- var.test(kobiety$ocena_samop_ogolna, mezczyzni$ocena_samop_ogolna)$p.value
```

Test F wykazuje, że wariancje Ogólnej oceny samopoczucia są równe w grupach kobiet i mężczyzn (p-value `r sprintf("%.5f", pval)`), zatem stosujemy test T dla średnich.

```{r}
pval <- t.test(kobiety$ocena_samop_ogolna, mezczyzni$ocena_samop_ogolna, var.equal = T, paired = F)$p.value
```

P-value z testu T wynosi `r sprintf("%.5f", pval)`, zatem odrzucamy hipotezę o równości średnich. Średnia ogólna ocena samopoczucia różni się istotnie w grupach kobiet i mężczyzn.

## Hipoteza IX

Badanie zależności między wiekiem a ogólną oceną samopoczucia.

```{r}
mod <- lm(ocena_samop_ogolna~wiek, data = dane)
```

```{r results = 'asis'}
stargazer(mod, type = "latex", header=F)
```


Istnieje istotna zależność pomiędzy ogólną oceną samopoczucia a wiekiem.

```{r}
dane %>%
  ggplot(aes(x = wiek, y = ocena_samop_ogolna)) +
  geom_point() +
  geom_smooth(se = F)+
  geom_smooth(method = lm, color = "red", se = F)
```

Na niebiesko regresja nieparametryczna, na czerwono liniowa.

```{r include = F}
plot(mod)
nortest::lillie.test(residuals(mod))
shapiro.test(residuals(mod)) #nie ma normalności - zle
lmtest::gqtest(mod, order.by = ~fitted(mod))
lmtest::hmctest(mod, order.by = ~fitted(mod))
lmtest::bptest(mod) #nie ma heterogeniczności - ok
lmtest::bgtest(mod, order.by = ~fitted(mod), order = 3) #nie ma autokorelacji reszt - ok
lmtest::raintest(mod, order.by=~fitted(mod))
lmtest::resettest(mod, power = 3, type = "regressor") #zależność jest liniowa - ok
```

Na podstawie wykresów diagnostycznych oraz odpowiednich testów mamy, że model spełnia założenia Gaussa - Markova, a jedynym problemem jest brak normalności rozkładu reszt (chociaż na wykresach diagnostycznych wygląda trochę na heterogeniczność wariancji).

## Wnioski

## Bibliografia




Skale do Pomiaru Nastroju i Sześciu
Emocji, Bogdan Wojciszke i Wiesław Baryła


Wspomaganie Statystycznej Analizy Wyników Badań Empirycznych w STATISTICA 9, Janusz Wątroba, StatSoft Polska Sp. z o. o.
